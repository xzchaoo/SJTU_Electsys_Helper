# 选课Helper #

## 介绍 ##
SJTU一共有3轮选课, 第一轮是海选, 每门开课接受任意数量的学生, 然后最后只保留一定量的学生; 第二轮是抢选, 只要有开课人数还不足就可以选; 第三轮选课, 只能选不能退.

## 用途 ##
对于第一轮, 用途不太大, 只能用于列出各种课程和当前的选课人数.
对于第二轮, 用途最大, 捡漏就趁现在了.
对于第三轮, 由于只能选不能退, 因此危险性较大, 慎重慎重.

## 思路 ##
每门开课有一个bsid唯一标识. 通过下面2种方法可以获取开课的信息, 并且没有频率限制(不会因为访问速度太快而被禁止). 
在抢课阶段, http://electsys.sjtu.edu.cn/edu/lesson/viewLessonArrangeDetail.aspx?bsid=? 允许访问, 通过这个页面可以抓取到关于这次开课的教师, 当前人数, 最大人数, 上课时间 等信息.
在任意阶段, 通过 http://electsys.sjtu.edu.cn/edu/lesson/viewLessonArrangeDetail2.aspx?bsid=? 可以访问到开课的信息, 并且比上面那个更详细一点.

因此我们只需要实现准备好要监控的bsid, 然后不断刷新这个页面就可以获得各个开课的信息了. 接下来要做的只是将获取到的信息展示出来.

对于大部分人, 要监控的bsid集合 = 该学期的所有类型的开课的bsid(各种通识课+各种任选课+各种...)
对于少部分人, 要监控的bsid集合 = 手动指定的bsid(即只监控某几门开课)

## 展示方式 ##
可以通过 通识课(人文,社会,自然科学) 任选课(开课院系) 等指标来筛选要显示的课程.
通过时间筛选的话, 可能会比较麻烦一点, 不过应该也是可以实现的.


### 如何获取开课的bsid ###
这个还是比较简单的, 基本上手动看一下url即可

### 如何批量获取开课的bsid ###
#### 策略1 ####
模拟手动选课的过程, 使用js脚本, 拼凑出url, 通过ajax获得页面, 然后抓取信息.
**优点** : 可以每门课程的类型(通选课, 任选课 ...)
**缺点** :
1. 每一步的操作都有频率限制, 太快的话会被服务器禁止.
2. 有的操作是post操作, 而post必须要带一些参数, 如果不带的话会被认为是非法请求. 这些参数必须从发出操作所在的页面进行获取.
3. 很有可能要分别对 通识课 任选课 等 编写处理代码, 以为它们的开课获取方式不相同.
4. 要进行这些操作必须在开放选课期间, 建议在模拟选课期间将这些数据全部抓取下来. 然后在选课期间世界使用抓取下来的数据以提高反应速度.

#### 策略2 ####
总的来说, bsid是递增的, 所以完全有可能通过大范围的扫描扫除所有开课.
比如, 扫描 http://electsys.sjtu.edu.cn/edu/lesson/viewLessonArrangeDetail2.aspx?bsid=1001 到 http://electsys.sjtu.edu.cn/edu/lesson/viewLessonArrangeDetail2.aspx?bsid=2000 , 这1000个开课的信息. 由于这个url没有频率限制, 因此速度非常快. 然后通过开课年份和学期 进行筛选
**缺点:** 会扫描到一堆乱七八糟的开课, 有的开课根本是没有开, 但是依旧有信息. 并且比较难反向推出这个开课的类型是通选课, 任选课 还是其他的什么.(这会造成你不知道去哪里选这门课, 通过bsid可以退出课程id(cid), 通过课程id可以推出开设课程的院系id, 但是可能这门课是作为通识课开的), 2015-2016年第一学期扫下来有3000多门开课, 我怎么想都是不太可能的吧?
当前其中有一些课程是有问题的, 比如落在某个范围里面的竟然有以前年份的开课, 我刚才假设的bsid是递增貌似有点问题? 不过好像实际的课程就是这么多 各种生的课程 + 二专 + 乱七八糟 
选课人数为0的有200多个 最大人数为0的有40多个 不是该学期的课程有100个 
这个策略不太好吧 不用了


因此这个方法有点损... 不太科学啊!
我以前用策略1扫描的时候才400多个开课, 当然我只能扫描到我能看到的开课, 比如有些研究生的课程我通过策略1肯定是没法扫到的

# 执行起点 #
通过下面的方法执行js脚本: 由于大部分浏览器不支持file协议, 因此需要自己来一个简单的服务器
javascript:{var s=document.createElement("script");s.src="http://127.0.0.1/1.js?r"+Math.random();document.head.appendChild(s);}

# 未完成 #
1. 写一个脚本可以生成所有需要的数据 防止每次都通过http拉去 太慢了, 反正很多信息都是不变的
2. 记得过滤掉没有课程的院系 和 没有开课的课程
3. 做好各种分类, 通识课 任选课 等

最终要的是获取所有开课的信息, 假设已经获取到了, 接下来要做整理, 使得他们的格式如下:
{
静态信息:
bsid 开课的id
name 开课的名称
cid 课程的id
teacher 老师的名字
time 上课时间描述
type 开课的类型信息(人文通识,社会通识还是其他什么任选课?)
url 链接(生成一个尽量靠近这个选课的url)
max 最大人数
杂信息
动态信息:
cur 当前人数, 对于一个学期, 几乎是整个系统唯一会变动的信息
}



# 期待的最终结果 #
登陆选课系统之后, 执行上面的js脚本, 然后会替换掉选课系统的外观.
接着可以选择选课的类型(通识课的人文学科等, 任选课的院系等), 类型单选还是多选?
然后就会显示类型对应的开课信息.
**注意**, 显示课程信息一般没啥用, 更重要的是显示开课信息.
